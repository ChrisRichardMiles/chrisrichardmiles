---

title: Core


keywords: fastai
sidebar: home_sidebar

summary: "Some basic functions used in the chrisrichardmiles library. "
description: "Some basic functions used in the chrisrichardmiles library. "
nb_path: "00_core.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 00_core.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">gc</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">zipfile</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">chain</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Union</span>
<span class="kn">from</span> <span class="nn">multiprocessing</span> <span class="kn">import</span> <span class="n">Pool</span><span class="p">,</span> <span class="n">cpu_count</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">psutil</span>
<span class="kn">from</span> <span class="nn">fastcore.script</span> <span class="kn">import</span> <span class="n">call_parse</span><span class="p">,</span> <span class="n">Param</span>
<span class="kn">from</span> <span class="nn">fastcore.parallel</span> <span class="kn">import</span> <span class="n">parallel</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-directories">Data directories<a class="anchor-link" href="#Data-directories"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="mkdirs_data" class="doc_header"><code>mkdirs_data</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L28" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>mkdirs_data</code>(<strong><code>data_dir_name</code></strong>:<code>str</code>=<em><code>'data'</code></em>)</p>
</blockquote>
<p>Initializes the data directory structure</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="cli_mkdirs_data" class="doc_header"><code>cli_mkdirs_data</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L35" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cli_mkdirs_data</code>(<strong><code>data_dir_name</code></strong>:"Name of data folder"=<em><code>'data'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="cp_tree" class="doc_header"><code>cp_tree</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L39" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cp_tree</code>(<strong><code>dir1</code></strong>:"path to directory to copy", <strong><code>dir2</code></strong>:"path to endpoint")</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">mkdirs_data</span><span class="p">(</span><span class="n">data_dir_name</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'data'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="sd">"""Initializes the data directory structure"""</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">data_dir_name</span><span class="si">}</span><span class="s1">/raw'</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">data_dir_name</span><span class="si">}</span><span class="s1">/interim'</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">data_dir_name</span><span class="si">}</span><span class="s1">/features'</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="sa">f</span><span class="s1">'</span><span class="si">{</span><span class="n">data_dir_name</span><span class="si">}</span><span class="s1">/models'</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
<span class="nd">@call_parse</span>
<span class="k">def</span> <span class="nf">cli_mkdirs_data</span><span class="p">(</span><span class="n">data_dir_name</span><span class="p">:</span> <span class="n">Param</span><span class="p">(</span><span class="s1">'Name of data folder'</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span><span class="o">=</span><span class="s1">'data'</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="n">mkdirs_data</span><span class="p">(</span><span class="n">data_dir_name</span><span class="p">)</span>
    
<span class="nd">@call_parse</span>
<span class="k">def</span> <span class="nf">cp_tree</span><span class="p">(</span><span class="n">dir1</span><span class="p">:</span> <span class="n">Param</span><span class="p">(</span><span class="s1">'path to directory to copy'</span><span class="p">,</span> <span class="nb">str</span><span class="p">),</span> 
            <span class="n">dir2</span><span class="p">:</span> <span class="n">Param</span><span class="p">(</span><span class="s1">'path to endpoint'</span><span class="p">,</span> <span class="nb">str</span><span class="p">)):</span> 
    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">dir1</span><span class="p">,</span> <span class="n">dir2</span><span class="p">,</span> <span class="n">dirs_exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="download_kaggle_data" class="doc_header"><code>download_kaggle_data</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L45" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>download_kaggle_data</code>(<strong><code>comp_name</code></strong>:<code>str</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Downloads competition data using the kaggle api</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="cli_download_kaggle_data" class="doc_header"><code>cli_download_kaggle_data</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L53" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cli_download_kaggle_data</code>(<strong><code>comp_name</code></strong>:"name of kaggle competition"=<em><code>None</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Saving-and-loading-flies">Saving and loading flies<a class="anchor-link" href="#Saving-and-loading-flies"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Prevent-saving-over-files">Prevent saving over files<a class="anchor-link" href="#Prevent-saving-over-files"> </a></h3><p>In order to to make sure we don't accidentally save over a file with the the same name, we have some functions to ensures that certain strings and paths are unique.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_unique" class="doc_header"><code>make_unique</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L58" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_unique</code>(<strong><code>name</code></strong>:<code>str</code>, <strong><code>names</code></strong>:<code>list or set or dict</code>)</p>
</blockquote>
<p>Returns name with (x)_ prefix if <code>name</code> already in <code>names</code>.
This is useful when you want to make sure you don't save over
existing data with the same key <code>name</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_unique</span><span class="p">(</span><span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">names</span><span class="p">:</span> <span class="s2">"list or set or dict"</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span> 
    <span class="sd">"""Returns name with (x)_ prefix if `name` already in `names`. </span>
<span class="sd">    This is useful when you want to make sure you don't save over</span>
<span class="sd">    existing data with the same key `name`.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">while</span> <span class="sa">f</span><span class="s1">'(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)_'</span> <span class="o">+</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span> <span class="n">x</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="n">name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">'(</span><span class="si">{</span><span class="n">x</span><span class="si">}</span><span class="s1">)_'</span> <span class="o">+</span> <span class="n">name</span>
    <span class="k">return</span> <span class="n">name</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">make_unique</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;d&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">make_unique</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;(1)_a&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">assert</span> <span class="n">make_unique</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">])</span> <span class="o">==</span> <span class="s1">'d'</span>
<span class="k">assert</span> <span class="n">make_unique</span><span class="p">(</span><span class="s1">'chris'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'chris'</span><span class="p">,</span> <span class="s1">'dan'</span><span class="p">,</span> <span class="s1">'bill'</span><span class="p">])</span> <span class="o">==</span> <span class="s1">'(1)_chris'</span>
<span class="k">assert</span> <span class="n">make_unique</span><span class="p">(</span><span class="s1">'chris'</span><span class="p">,</span> <span class="p">[</span><span class="s1">'chris'</span><span class="p">,</span> <span class="s1">'dan'</span><span class="p">,</span> <span class="s1">'bill'</span><span class="p">,</span> <span class="s1">'(1)_chris'</span><span class="p">])</span> <span class="o">==</span> <span class="s1">'(2)_chris'</span>
<span class="k">assert</span> <span class="n">make_unique</span><span class="p">(</span><span class="s1">'chris'</span><span class="p">,</span> <span class="nb">set</span><span class="p">([</span><span class="s1">'chris'</span><span class="p">,</span> <span class="s1">'dan'</span><span class="p">,</span> <span class="s1">'bill'</span><span class="p">,</span> <span class="s1">'(1)_chris'</span><span class="p">]))</span> <span class="o">==</span> <span class="s1">'(2)_chris'</span>
<span class="k">assert</span> <span class="n">make_unique</span><span class="p">(</span><span class="s1">'a'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="o">==</span> <span class="s1">'(1)_a'</span>
<span class="k">assert</span> <span class="n">make_unique</span><span class="p">(</span><span class="s1">'d'</span><span class="p">,</span> <span class="p">{</span><span class="s1">'a'</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">:</span> <span class="mi">3</span><span class="p">})</span> <span class="o">==</span> <span class="s1">'d'</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="make_unique_path" class="doc_header"><code>make_unique_path</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L70" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>make_unique_path</code>(<strong><code>path</code></strong>)</p>
</blockquote>
<p>Returns path with prefix '(n)_' before the last element in
path if it is a duplicate.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">make_unique_path</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>  
    <span class="sd">"""Returns path with prefix '(n)_' before the last element in </span>
<span class="sd">    path if it is a duplicate. </span>
<span class="sd">    """</span>
    <span class="n">pre_path</span><span class="p">,</span> <span class="n">file_name</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">make_unique</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">pre_path</span> <span class="ow">or</span> <span class="s1">'.'</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">pre_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">'tmp'</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">make_unique_path</span><span class="p">(</span><span class="s1">'tmp/tmp.csv'</span><span class="p">))</span>
<span class="nb">open</span><span class="p">(</span><span class="s1">'tmp/tmp.csv'</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="n">make_unique_path</span><span class="p">(</span><span class="s1">'tmp/tmp.csv'</span><span class="p">))</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="s1">'tmp'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>tmp/tmp.csv
tmp/(1)_tmp.csv
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-and-loading-pandas-dataframes">Saving and loading pandas dataframes<a class="anchor-link" href="#Saving-and-loading-pandas-dataframes"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="save_file" class="doc_header"><code>save_file</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L79" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>save_file</code>(<strong><code>df</code></strong>:<code>DataFrame</code>, <strong><code>path</code></strong>:<code>str</code>, <strong><code>usecols</code></strong>:<code>list</code>=<em><code>None</code></em>, <strong><code>save_index</code></strong>:<code>bool</code>=<em><code>False</code></em>, <strong><code>save_dtypes</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>pickle</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Saves <code>df</code> to <code>path</code> with dtypes as top column if <code>save_dtypes</code>
is set to True. Load a files in this structure with <a href="/chrisrichardmiles/core.html#load_file"><code>load_file</code></a></p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_file" class="doc_header"><code>load_file</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L108" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_file</code>(<strong><code>path</code></strong>:<code>str</code>, <strong><code>load_dtypes</code></strong>=<em><code>True</code></em>, <strong><code>usecols</code></strong>:<code>list</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Loads a file into a DataFrame from <code>path</code> with dtypes
taken from the top column if <code>load_dtypes</code> is set to True.
Loads a files in the structure created with <a href="/chrisrichardmiles/core.html#save_file"><code>save_file</code></a>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">save_file</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> 
              <span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> 
              <span class="n">usecols</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
              <span class="n">save_index</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
              <span class="n">save_dtypes</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> 
              <span class="n">pickle</span><span class="p">:</span> <span class="nb">bool</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">"""Saves `df` to `path` with dtypes as top column if `save_dtypes` </span>
<span class="sd">    is set to True. Load a files in this structure with `load_file`</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">pickle</span><span class="p">:</span> 
        <span class="n">usecols</span> <span class="o">=</span> <span class="n">usecols</span> <span class="k">if</span> <span class="n">usecols</span> <span class="k">else</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">path_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.csv'</span><span class="p">)</span> <span class="k">else</span> <span class="n">path</span> <span class="c1"># For M5 project maintenence</span>
        <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">df</span><span class="p">):</span> 
            <span class="n">df</span><span class="p">[[</span><span class="n">col</span><span class="p">]]</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path_dir</span><span class="p">,</span> <span class="n">col</span> <span class="o">+</span> <span class="s1">'.pkl'</span><span class="p">))</span>
        <span class="k">return</span> 
    
    <span class="n">path</span> <span class="o">=</span> <span class="n">make_unique_path</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">save_dtypes</span><span class="p">:</span>
        <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">],</span> <span class="p">:]</span>
        <span class="k">if</span> <span class="n">usecols</span><span class="p">:</span> <span class="n">df_tmp</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">loc</span><span class="p">[:,</span> <span class="n">usecols</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">save_index</span><span class="p">:</span> 
            <span class="n">df_tmp</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">df_dtypes</span> <span class="o">=</span> <span class="n">df_tmp</span><span class="o">.</span><span class="n">dtypes</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">T</span>
        <span class="n">df_dtypes</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">'a'</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">save_index</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> 
                  <span class="n">columns</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span> 
        <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">save_index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
        
<span class="k">def</span> <span class="nf">load_file</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">load_dtypes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">usecols</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
    <span class="sd">"""Loads a file into a DataFrame from `path` with dtypes </span>
<span class="sd">    taken from the top column if `load_dtypes` is set to True. </span>
<span class="sd">    Loads a files in the structure created with `save_file`.</span>
<span class="sd">    """</span>
    <span class="k">if</span> <span class="n">path</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'pkl'</span><span class="p">):</span> 
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">df</span><span class="p">[</span><span class="n">usecols</span><span class="p">]</span> <span class="k">if</span> <span class="n">usecols</span> <span class="k">else</span> <span class="n">df</span>
    
    <span class="k">if</span> <span class="n">load_dtypes</span><span class="p">:</span>
        <span class="n">dtypes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="n">usecols</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'a'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">],</span> <span class="s1">'b'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'foo'</span><span class="p">,</span> <span class="s1">'bar'</span><span class="p">],</span> <span class="s1">'c'</span><span class="p">:</span> <span class="p">[</span><span class="mf">1.2</span><span class="p">,</span> <span class="mf">3.3</span><span class="p">]})</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">([</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">],</span> <span class="p">[</span><span class="s1">'int32'</span><span class="p">,</span> <span class="s1">'category'</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">])))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Saving the the dataframe to csv with the dtypes'</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
<span class="n">save_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">'tmp.csv'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">'Now the csv has the datatypes as the top line when we read it in'</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'tmp.csv'</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">'We can use `load_file` to read in the csv with the right dtypes'</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">load_file</span><span class="p">(</span><span class="s1">'tmp.csv'</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">load_file</span><span class="p">(</span><span class="s1">'tmp.csv'</span><span class="p">)</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Saving the the dataframe to csv with the dtypes
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>a       int32
b    category
c     float16
dtype: object</pre>
</div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Now the csv has the datatypes as the top line when we read it in
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>int32</td>
      <td>category</td>
      <td>float16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>foo</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>bar</td>
      <td>3.3</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>We can use `load_file` to read in the csv with the right dtypes
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>foo</td>
      <td>1.200195</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>bar</td>
      <td>3.300781</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>a       int32
b    category
c     float16
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">'.'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">load_file</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="s1">'.pkl'</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s1">'abc'</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
<span class="o">!</span>rm a.pkl b.pkl c.pkl
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>foo</td>
      <td>1.200195</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>bar</td>
      <td>3.300781</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">save_file</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">'tmp2.csv'</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">],</span> <span class="n">save_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">load_file</span><span class="p">(</span><span class="s1">'tmp2.csv'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>index</th>
      <th>a</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>1.200195</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>3.300781</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm tmp*.csv
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values.">Making a dictionary and json with file names as keys and list of column names as values.<a class="anchor-link" href="#Making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values."> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>.devcontainer.json
.git
.gitattributes
.gitconfig
.github
.gitignore
.ipynb_checkpoints
.pypirc
00_core.ipynb
CONTRIBUTING.md
LICENSE
MANIFEST.in
Makefile
README.md
chrisrichardmiles
chrisrichardmiles.egg-info
data
docker-compose.yml
docs
index.ipynb
log.log
projects
settings.ini
setup.py
small_data
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_file_cols_dict" class="doc_header"><code>get_file_cols_dict</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L124" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_file_cols_dict</code>(<strong><code>path</code></strong>:<code>str</code>=<em><code>'.'</code></em>, <strong><code>path_json</code></strong>:<code>str</code>=<em><code>''</code></em>, <strong><code>ignore_cols</code></strong>:<code>list</code>=<em><code>['index']</code></em>)</p>
</blockquote>
<p>Explores <code>path</code> and returns a dictionary of file names and their columns
for each file in <code>path</code>. Only file names that end with
'.csv' and '.pkl' will be considered. Pickle file names
will go in the 'pickles' key of the returned dictionary.
Csv files will see their file name saved as a key with
a list of their column names saved as the corresponding
value.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="fe_dict" class="doc_header"><code>fe_dict</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L148" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>fe_dict</code>(<strong><code>path</code></strong>:"path to directory with files"=<em><code>'data/features'</code></em>, <strong><code>path_json</code></strong>:"path to json for saving dict"=<em><code>'fe_dict.json'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_file_cols_dict</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">'.'</span><span class="p">,</span> 
                       <span class="n">path_json</span><span class="p">:</span> <span class="nb">str</span><span class="o">=</span><span class="s1">''</span><span class="p">,</span> 
                       <span class="n">ignore_cols</span><span class="p">:</span> <span class="nb">list</span><span class="o">=</span><span class="p">[</span><span class="s1">'index'</span><span class="p">]):</span>
    <span class="sd">"""Explores `path` and returns a dictionary of file names and their columns</span>
<span class="sd">    for each file in `path`. Only file names that end with </span>
<span class="sd">    '.csv' and '.pkl' will be considered. Pickle file names</span>
<span class="sd">    will go in the 'pickles' key of the returned dictionary.</span>
<span class="sd">    Csv files will see their file name saved as a key with </span>
<span class="sd">    a list of their column names saved as the corresponding </span>
<span class="sd">    value.</span>
<span class="sd">    """</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span> 
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.csv'</span><span class="p">):</span> 
            <span class="n">cols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">file</span><span class="p">),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">d</span><span class="p">[</span><span class="n">file</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cols</span> <span class="k">if</span> <span class="n">c</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">ignore_cols</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">file</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">'.pkl'</span><span class="p">):</span> 
            <span class="n">d</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s1">'pickles'</span><span class="p">,</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">path_json</span><span class="p">:</span> 
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path_json</span><span class="p">,</span> <span class="s1">'w'</span><span class="p">)</span> <span class="k">as</span> <span class="n">path_json</span><span class="p">:</span> 
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">path_json</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>

<span class="nd">@call_parse</span>
<span class="k">def</span> <span class="nf">fe_dict</span><span class="p">(</span><span class="n">path</span><span class="p">:</span> <span class="n">Param</span><span class="p">(</span><span class="s1">'path to directory with files'</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span><span class="o">=</span><span class="s1">'data/features'</span><span class="p">,</span> 
            <span class="n">path_json</span><span class="p">:</span> <span class="n">Param</span><span class="p">(</span><span class="s1">'path to json for saving dict'</span><span class="p">,</span> <span class="nb">str</span><span class="p">)</span><span class="o">=</span><span class="s1">'fe_dict.json'</span><span class="p">):</span>
    <span class="n">get_file_cols_dict</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">path_json</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'feat_1'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s1">'feat_2'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s1">'feat_3'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">4</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]})</span>
<span class="n">df2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'shift_feat_4'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s1">'shift_feat_5'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">9</span><span class="p">],</span> <span class="s1">'shift_feat_6'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]})</span>
<span class="n">df3</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'feat_7'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s1">'feat_8'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s1">'feat_9'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">]})</span>
<span class="n">df4</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">'feat_10'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="s1">'feat_11'</span><span class="p">:</span> <span class="p">[</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="s1">'feat_12'</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> 
                    <span class="s1">'feat_13'</span><span class="p">:</span> <span class="p">[</span><span class="s1">'a'</span><span class="p">,</span> <span class="s1">'b'</span><span class="p">,</span> <span class="s1">'c'</span><span class="p">,</span> <span class="s1">'d'</span><span class="p">]})</span>
<span class="n">df4</span><span class="o">.</span><span class="n">feat_10</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">feat_10</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'int8'</span><span class="p">)</span>
<span class="n">df4</span><span class="o">.</span><span class="n">feat_13</span> <span class="o">=</span> <span class="n">df4</span><span class="o">.</span><span class="n">feat_13</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">'category'</span><span class="p">)</span>

<span class="n">save_file</span><span class="p">(</span><span class="n">df1</span><span class="p">,</span> <span class="s1">'features_1.csv'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">save_file</span><span class="p">(</span><span class="n">df2</span><span class="p">,</span> <span class="s1">'shift_features_2.csv'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">save_file</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span> <span class="s1">'features_3.csv'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">save_file</span><span class="p">(</span><span class="n">df4</span><span class="p">,</span> <span class="s1">'features_4.csv'</span><span class="p">,</span> <span class="n">save_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">save_file</span><span class="p">(</span><span class="n">df3</span><span class="p">,</span> <span class="s1">'features_3_less_cols.csv'</span><span class="p">,</span> <span class="n">usecols</span><span class="o">=</span><span class="p">[</span><span class="s1">'feat_7'</span><span class="p">],</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_file_cols_dict</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="n">path_json</span><span class="o">=</span><span class="s1">'tmp_features.json'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;features_1.csv&#39;: [&#39;feat_1&#39;, &#39;feat_2&#39;, &#39;feat_3&#39;],
 &#39;features_3.csv&#39;: [&#39;feat_7&#39;, &#39;feat_8&#39;, &#39;feat_9&#39;],
 &#39;features_3_less_cols.csv&#39;: [&#39;feat_7&#39;],
 &#39;features_4.csv&#39;: [&#39;feat_10&#39;, &#39;feat_11&#39;, &#39;feat_12&#39;, &#39;feat_13&#39;],
 &#39;shift_features_2.csv&#39;: [&#39;shift_feat_4&#39;, &#39;shift_feat_5&#39;, &#39;shift_feat_6&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_file_cols_dict</span><span class="p">(</span><span class="s1">'.'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;features_1.csv&#39;: [&#39;feat_1&#39;, &#39;feat_2&#39;, &#39;feat_3&#39;],
 &#39;features_3.csv&#39;: [&#39;feat_7&#39;, &#39;feat_8&#39;, &#39;feat_9&#39;],
 &#39;features_3_less_cols.csv&#39;: [&#39;feat_7&#39;],
 &#39;features_4.csv&#39;: [&#39;feat_10&#39;, &#39;feat_11&#39;, &#39;feat_12&#39;, &#39;feat_13&#39;],
 &#39;shift_features_2.csv&#39;: [&#39;shift_feat_4&#39;, &#39;shift_feat_5&#39;, &#39;shift_feat_6&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Loading-features">Loading features<a class="anchor-link" href="#Loading-features"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_features" class="doc_header"><code>load_features</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L154" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_features</code>(<strong><code>path_features</code></strong>:<code>Union</code>[<code>list</code>, <code>str</code>], <strong><code>dict_features</code></strong>:<code>Union</code>[<code>dict</code>, <code>str</code>]=<em><code>None</code></em>, <strong><code>shift_index</code></strong>:<code>int</code>=<em><code>0</code></em>, <strong><code>reindex_with</code></strong>:<code>list like</code>=<em><code>None</code></em>, <strong><code>shift_prefix</code></strong>:<code>Union</code>[<code>str</code>, <code>bool</code>]=<em><code>'shift'</code></em>, <strong><code>load_dtypes</code></strong>:<code>bool</code>=<em><code>True</code></em>, <strong><code>features</code></strong>:<code>list</code>=<em><code>None</code></em>, <strong><code>pickle</code></strong>:<code>bool</code>=<em><code>True</code></em>)</p>
</blockquote>
<p>Loads the features selected in <code>dict_features</code> into a dataframe.
<code>dict_features</code> Must be a module that is located in the working
directory.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>path_features: Union[list, str]
    path to the folder that holds the features files</p>
<p>dict_features: Union[dict, str]
    dict or path to the json that holds the feature dictionary. Set this
    parameter to None if you want to load all csv files, optionally
    filtered by <code>features</code> list.</p>
<p>shift_index: int=0
    used to shift columns of files starting with <code>shift_prefix</code> when training
    for prediction periods past day 1.</p>
<p>shift_prefix: Union[str, bool]='shift'
    The prefix of files that should have their index shifted for
    proper lag alignment in time series prediction.
    Set this to the boolean True to shift index of all files.</p>
<p>reindex_with: "list like"=None
    Use anything that works with df.reindex(reindex_with). This is used when you
    only need rows for a subset of the orginal data.</p>
<p>load_dtype: bool=True
    This will use the first row for dtypes</p>
<p>features: list=None
    An explicit list of features that you want. Only these will be loaded
    if provided.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we can easily load in our features with the correct data types</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_features</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'tmp_features.json'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>b</td>
      <td>9</td>
      <td>1</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>c</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>d</td>
      <td>4</td>
      <td>9</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">load_features</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'tmp_features.json'</span><span class="p">,</span> <span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="s1">'feat_3'</span><span class="p">,</span> <span class="s1">'feat_10'</span><span class="p">,</span> <span class="s1">'feat_13'</span><span class="p">],</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat_3</th>
      <th>feat_10</th>
      <th>feat_13</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>a</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>7</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>c</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>4</td>
      <td>d</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>feat_3        int64
feat_10        int8
feat_13    category
dtype: object</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sometimes we need to shift the index so that our lag features are in the correct allignment.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_features</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'tmp_features.json'</span><span class="p">,</span> <span class="n">shift_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>a</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>b</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>c</td>
      <td>9.0</td>
      <td>1.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>d</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>9.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sometimes we are loading features for a subset of the data so we only need to load the rows associated with certain indexes.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_features</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'tmp_features.json'</span><span class="p">,</span> <span class="n">shift_index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">reindex_with</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>b</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>d</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can use a copy of the feature module, easily comment out features we don't want, and use this to load features.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">shutil</span><span class="o">.</span><span class="n">copyfile</span><span class="p">(</span><span class="s1">'tmp_features.json'</span><span class="p">,</span> <span class="s1">'tmp_features_1.json'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;tmp_features_1.json&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>open <code>tmp_features_1.json</code> and delete features</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>cat tmp_features_1.json
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>{
&#34;features_1.csv&#34;: [
&#34;feat_1&#34;,
&#34;feat_2&#34;,
&#34;feat_3&#34;
],
&#34;features_3.csv&#34;: [
&#34;feat_7&#34;,
&#34;feat_8&#34;,
&#34;feat_9&#34;
],
&#34;features_3_less_cols.csv&#34;: [
&#34;feat_7&#34;
],
&#34;features_4.csv&#34;: [
&#34;feat_10&#34;,
&#34;feat_11&#34;,
&#34;feat_12&#34;,
&#34;feat_13&#34;
],
&#34;shift_features_2.csv&#34;: [
&#34;shift_feat_4&#34;,
&#34;shift_feat_5&#34;,
&#34;shift_feat_6&#34;
]
}</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">load_features</span><span class="p">(</span><span class="s1">'.'</span><span class="p">,</span> <span class="s1">'tmp_features_1.json'</span><span class="p">,</span> <span class="n">pickle</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>b</td>
      <td>9</td>
      <td>1</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>c</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>d</td>
      <td>4</td>
      <td>9</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>rm *.csv
<span class="o">!</span>rm tmp*.json
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Speed-and-memory-functions">Speed and memory functions<a class="anchor-link" href="#Speed-and-memory-functions"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Paralel-runs">Paralel runs<a class="anchor-link" href="#Paralel-runs"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="pool_func" class="doc_header"><code>pool_func</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L244" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>pool_func</code>(<strong><code>function</code></strong>, <strong><code>input_list</code></strong>:<code>list</code>, <strong><code>verbose</code></strong>=<em><code>False</code></em>, <strong><code>n_cpu</code></strong>=<em><code>99</code></em>)</p>
</blockquote>
<p>Uses the Pool function from the package 'multiprocessing'
to run <code>function</code> over the list <code>input_list</code>.  The <code>function</code>
should only take</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">f</span><span class="p">(</span><span class="n">x</span><span class="p">):</span> <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="mi">5</span>
<span class="n">pool_func</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">20</span><span class="p">)),</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>#############################################
Pooling function: 
f
16 of 16 cpus used
Number of function calls:  20
Time taken: 0.0 minutes
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Saving-memory">Saving memory<a class="anchor-link" href="#Saving-memory"> </a></h3>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="reduce_mem_usage" class="doc_header"><code>reduce_mem_usage</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L271" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>reduce_mem_usage</code>(<strong><code>df</code></strong>, <strong><code>verbose</code></strong>=<em><code>True</code></em>)</p>
</blockquote>
<p>Converts numeric columns to smallest datatype that preserves information</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="merge_by_concat" class="doc_header"><code>merge_by_concat</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L302" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>merge_by_concat</code>(<strong><code>df1</code></strong>, <strong><code>df2</code></strong>, <strong><code>merge_on</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="get_memory_usage" class="doc_header"><code>get_memory_usage</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L311" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>get_memory_usage</code>()</p>
</blockquote>
<p>Returns RAM usage in gigabytes</p>
<h2 id="Explanation-of-code">Explanation of code<a class="anchor-link" href="#Explanation-of-code"> </a></h2><h1 id="getpid:-gets-the-process-id-number.">getpid: gets the process id number.<a class="anchor-link" href="#getpid:-gets-the-process-id-number."> </a></h1><h1 id="psutil.process-gets-that-process-with-a-certain-pid.">psutil.process gets that process with a certain pid.<a class="anchor-link" href="#psutil.process-gets-that-process-with-a-certain-pid."> </a></h1><h1 id=".memory_info()-describes-notebook-memory-usage.">.memory_info() describes notebook memory usage.<a class="anchor-link" href="#.memory_info()-describes-notebook-memory-usage."> </a></h1><h1 id="%5B0%5D-gets-the-rss-resident-state-size-of-(process-I-think)-in-bytes.">[0] gets the rss resident state size of (process I think) in bytes.<a class="anchor-link" href="#%5B0%5D-gets-the-rss-resident-state-size-of-(process-I-think)-in-bytes."> </a></h1><h1 id="/2.**30-converts-output-from-bytes-to-gigabytes">/2.**30 converts output from bytes to gigabytes<a class="anchor-link" href="#/2.**30-converts-output-from-bytes-to-gigabytes"> </a></h1>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="sizeof_fmt" class="doc_header"><code>sizeof_fmt</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L324" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>sizeof_fmt</code>(<strong><code>num</code></strong>, <strong><code>suffix</code></strong>=<em><code>'B'</code></em>)</p>
</blockquote>
<p>Reformats <code>num</code>, which is num bytes</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">get_memory_usage</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>0.14</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_markdown rendered_html output_subarea ">
<h4 id="time_taken" class="doc_header"><code>time_taken</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/core.py#L333" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>time_taken</code>(<strong><code>start_time</code></strong>:<code>float</code>=<em><code>0</code></em>, <strong><code>time_elapsed</code></strong>:<code>float</code>=<em><code>None</code></em>)</p>
</blockquote>
<p>Returns a string with the time elapsed from <code>start_time</code>
in a nice format. If <code>time_elapsed</code> is provided, we ignore
the start time.</p>
<p><code>start_time</code> should come from by calling the time module:
start_time = time.time()</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">time_taken</span><span class="p">(</span><span class="n">start_time</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Time taken: 2 seconds&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">time_taken</span><span class="p">(</span><span class="n">time_elapsed</span><span class="o">=</span><span class="mi">3666</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;Time taken: 1 hours 1 minutes 6 seconds&#39;</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>


