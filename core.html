<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.251">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="Some basic functions used in the chrisrichardmiles library.">

<title>chrisrichardmiles - Core</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="chrisrichardmiles - Core">
<meta property="og:description" content="Some basic functions used in the chrisrichardmiles library.">
<meta property="og:site-name" content="chrisrichardmiles">
<meta name="twitter:title" content="chrisrichardmiles - Core">
<meta name="twitter:description" content="Some basic functions used in the chrisrichardmiles library.">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">chrisrichardmiles</span>
    </a>
  </div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
    <div class="container-fluid d-flex justify-content-between">
      <h1 class="quarto-secondary-nav-title">Core</h1>
      <button type="button" class="quarto-btn-toggle btn" aria-label="Show secondary navigation">
        <i class="bi bi-chevron-right"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">chrisrichardmiles</a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./core.html" class="sidebar-item-text sidebar-link active">Core</a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">projects</a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">m5</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/m5/index_m5.html" class="sidebar-item-text sidebar-link">Welcome to chrisrichardmiles.m5</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/m5/brief_eda.html" class="sidebar-item-text sidebar-link">Brief EDA</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/m5/feature_engineering.html" class="sidebar-item-text sidebar-link">Feature engineering</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/m5/04_out_of_stock_detection.html" class="sidebar-item-text sidebar-link">Total sales for all series of aggregation</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/m5/training_day_by_day_models.html" class="sidebar-item-text sidebar-link">Train day-by-day models</a>
  </div>
</li>
      </ul>
  </li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">optiver</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth2 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/index_optiver.html" class="sidebar-item-text sidebar-link">Optiver Realized Volatility Prediction: 91st place solution</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/opt-error-analysis.html" class="sidebar-item-text sidebar-link">Error analysis</a>
  </div>
</li>
          <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">notebooks</a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="false">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth3 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/notebooks/opt-book-trade-eda.html" class="sidebar-item-text sidebar-link">price features</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/notebooks/opt-eda-modified-from-host-nb.html" class="sidebar-item-text sidebar-link">Optiver Realized Volatility Prediction</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/notebooks/opt-train-dart-op-129a-stock-31-only.html" class="sidebar-item-text sidebar-link">opt-train-dart-op-129a-stock-31-only.html</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/notebooks/opt-train-dart.html" class="sidebar-item-text sidebar-link">opt-train-dart.html</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/notebooks/opt-train-one-at-a-time.html" class="sidebar-item-text sidebar-link">opt-train-one-at-a-time.html</a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./projects/optiver/notebooks/opt-train-tabnet-142.html" class="sidebar-item-text sidebar-link">opt-train-tabnet-142.html</a>
  </div>
</li>
      </ul>
  </li>
      </ul>
  </li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#make-data-folder-with-subfolders-raw-interim-features-models" id="toc-make-data-folder-with-subfolders-raw-interim-features-models" class="nav-link active" data-scroll-target="#make-data-folder-with-subfolders-raw-interim-features-models">Make data folder with subfolders raw, interim, features, models</a>
  <ul class="collapse">
  <li><a href="#cli_mkdirs_data" id="toc-cli_mkdirs_data" class="nav-link" data-scroll-target="#cli_mkdirs_data">cli_mkdirs_data</a></li>
  <li><a href="#mkdirs_data" id="toc-mkdirs_data" class="nav-link" data-scroll-target="#mkdirs_data">mkdirs_data</a></li>
  </ul></li>
  <li><a href="#downloading-kaggle-data" id="toc-downloading-kaggle-data" class="nav-link" data-scroll-target="#downloading-kaggle-data">Downloading kaggle data</a>
  <ul class="collapse">
  <li><a href="#cli_download_kaggle_data" id="toc-cli_download_kaggle_data" class="nav-link" data-scroll-target="#cli_download_kaggle_data">cli_download_kaggle_data</a></li>
  <li><a href="#download_kaggle_data" id="toc-download_kaggle_data" class="nav-link" data-scroll-target="#download_kaggle_data">download_kaggle_data</a></li>
  </ul></li>
  <li><a href="#saving-and-loading-flies" id="toc-saving-and-loading-flies" class="nav-link" data-scroll-target="#saving-and-loading-flies">Saving and loading flies</a>
  <ul class="collapse">
  <li><a href="#prevent-saving-over-files" id="toc-prevent-saving-over-files" class="nav-link" data-scroll-target="#prevent-saving-over-files">Prevent saving over files</a></li>
  <li><a href="#make_unique" id="toc-make_unique" class="nav-link" data-scroll-target="#make_unique">make_unique</a></li>
  <li><a href="#make_unique_path" id="toc-make_unique_path" class="nav-link" data-scroll-target="#make_unique_path">make_unique_path</a></li>
  <li><a href="#saving-and-loading-pandas-dataframes" id="toc-saving-and-loading-pandas-dataframes" class="nav-link" data-scroll-target="#saving-and-loading-pandas-dataframes">Saving and loading pandas dataframes</a></li>
  <li><a href="#load_file" id="toc-load_file" class="nav-link" data-scroll-target="#load_file">load_file</a></li>
  <li><a href="#save_file" id="toc-save_file" class="nav-link" data-scroll-target="#save_file">save_file</a></li>
  <li><a href="#making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values." id="toc-making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values." class="nav-link" data-scroll-target="#making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values.">Making a dictionary and json with file names as keys and list of column names as values.</a></li>
  <li><a href="#fe_dict" id="toc-fe_dict" class="nav-link" data-scroll-target="#fe_dict">fe_dict</a></li>
  <li><a href="#get_file_cols_dict" id="toc-get_file_cols_dict" class="nav-link" data-scroll-target="#get_file_cols_dict">get_file_cols_dict</a></li>
  <li><a href="#loading-features" id="toc-loading-features" class="nav-link" data-scroll-target="#loading-features">Loading features</a></li>
  </ul></li>
  <li><a href="#speed-and-memory-functions" id="toc-speed-and-memory-functions" class="nav-link" data-scroll-target="#speed-and-memory-functions">Speed and memory functions</a>
  <ul class="collapse">
  <li><a href="#paralel-runs" id="toc-paralel-runs" class="nav-link" data-scroll-target="#paralel-runs">Paralel runs</a></li>
  <li><a href="#pool_func" id="toc-pool_func" class="nav-link" data-scroll-target="#pool_func">pool_func</a></li>
  <li><a href="#saving-memory" id="toc-saving-memory" class="nav-link" data-scroll-target="#saving-memory">Saving memory</a></li>
  <li><a href="#reduce_mem_usage" id="toc-reduce_mem_usage" class="nav-link" data-scroll-target="#reduce_mem_usage">reduce_mem_usage</a></li>
  <li><a href="#merge_by_concat" id="toc-merge_by_concat" class="nav-link" data-scroll-target="#merge_by_concat">merge_by_concat</a></li>
  <li><a href="#sizeof_fmt" id="toc-sizeof_fmt" class="nav-link" data-scroll-target="#sizeof_fmt">sizeof_fmt</a></li>
  <li><a href="#get_memory_usage" id="toc-get_memory_usage" class="nav-link" data-scroll-target="#get_memory_usage">get_memory_usage</a></li>
  <li><a href="#time_taken" id="toc-time_taken" class="nav-link" data-scroll-target="#time_taken">time_taken</a></li>
  </ul></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title d-none d-lg-block">Core</h1>
</div>

<div>
  <div class="description">
    Some basic functions used in the chrisrichardmiles library.
  </div>
</div>


<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="make-data-folder-with-subfolders-raw-interim-features-models" class="level2">
<h2 class="anchored" data-anchor-id="make-data-folder-with-subfolders-raw-interim-features-models">Make data folder with subfolders raw, interim, features, models</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mkdirs_data(data_dir_name: <span class="bu">str</span><span class="op">=</span><span class="st">'data'</span>) <span class="op">-&gt;</span> <span class="va">None</span>: </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Initializes the data directory structure"""</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="ss">f'</span><span class="sc">{</span>data_dir_name<span class="sc">}</span><span class="ss">/raw'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="ss">f'</span><span class="sc">{</span>data_dir_name<span class="sc">}</span><span class="ss">/interim'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="ss">f'</span><span class="sc">{</span>data_dir_name<span class="sc">}</span><span class="ss">/features'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    os.makedirs(<span class="ss">f'</span><span class="sc">{</span>data_dir_name<span class="sc">}</span><span class="ss">/models'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="at">@call_parse</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> cli_mkdirs_data(data_dir_name: Param(<span class="st">'Name of data folder'</span>, <span class="bu">str</span>)<span class="op">=</span><span class="st">'data'</span>) <span class="op">-&gt;</span> <span class="va">None</span>: </span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>    mkdirs_data(data_dir_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L36" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="cli_mkdirs_data" class="level3">
<h3 class="anchored" data-anchor-id="cli_mkdirs_data">cli_mkdirs_data</h3>
<blockquote class="blockquote">
<pre><code> cli_mkdirs_data (data_dir_name:str&lt;Nameofdatafolder&gt;='data')</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L28" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="mkdirs_data" class="level3">
<h3 class="anchored" data-anchor-id="mkdirs_data">mkdirs_data</h3>
<blockquote class="blockquote">
<pre><code> mkdirs_data (data_dir_name:str='data')</code></pre>
</blockquote>
<p>Initializes the data directory structure</p>
</section>
</section>
<section id="downloading-kaggle-data" class="level2">
<h2 class="anchored" data-anchor-id="downloading-kaggle-data">Downloading kaggle data</h2>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L50" target="_blank" style="float:right; font-size:smaller">source</a></p>
<section id="cli_download_kaggle_data" class="level3">
<h3 class="anchored" data-anchor-id="cli_download_kaggle_data">cli_download_kaggle_data</h3>
<blockquote class="blockquote">
<pre><code> cli_download_kaggle_data (comp_name:str&lt;nameofkagglecompetition&gt;=None)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L41" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="download_kaggle_data" class="level3">
<h3 class="anchored" data-anchor-id="download_kaggle_data">download_kaggle_data</h3>
<blockquote class="blockquote">
<pre><code> download_kaggle_data (comp_name:str=None)</code></pre>
</blockquote>
<p>Downloads competition data using the kaggle api</p>
</section>
</section>
<section id="saving-and-loading-flies" class="level2">
<h2 class="anchored" data-anchor-id="saving-and-loading-flies">Saving and loading flies</h2>
<section id="prevent-saving-over-files" class="level3">
<h3 class="anchored" data-anchor-id="prevent-saving-over-files">Prevent saving over files</h3>
<p>In order to to make sure we don’t accidentally save over a file with the the same name, we have some functions to ensures that certain strings and paths are unique.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_unique(name: <span class="bu">str</span>, names: <span class="st">"list or set or dict"</span>) <span class="op">-&gt;</span> <span class="bu">str</span>: </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Returns name with (x)_ prefix if `name` already in `names`. </span></span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a><span class="co">    This is useful when you want to make sure you don't save over</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a><span class="co">    existing data with the same key `name`.</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> name <span class="kw">in</span> names:</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">while</span> <span class="ss">f'(</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">)_'</span> <span class="op">+</span> name <span class="kw">in</span> names: x <span class="op">+=</span> <span class="dv">1</span></span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>        name <span class="op">=</span> <span class="ss">f'(</span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">)_'</span> <span class="op">+</span> name</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> name</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L54" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="make_unique" class="level3">
<h3 class="anchored" data-anchor-id="make_unique">make_unique</h3>
<blockquote class="blockquote">
<pre><code> make_unique (name:str, names:list)</code></pre>
</blockquote>
<p>Returns name with (x)_ prefix if <code>name</code> already in <code>names</code>. This is useful when you want to make sure you don’t save over existing data with the same key <code>name</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>make_unique(<span class="st">'d'</span>, [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'d'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>make_unique(<span class="st">'a'</span>, [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'(1)_a'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> make_unique(<span class="st">'d'</span>, [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>]) <span class="op">==</span> <span class="st">'d'</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> make_unique(<span class="st">'chris'</span>, [<span class="st">'chris'</span>, <span class="st">'dan'</span>, <span class="st">'bill'</span>]) <span class="op">==</span> <span class="st">'(1)_chris'</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> make_unique(<span class="st">'chris'</span>, [<span class="st">'chris'</span>, <span class="st">'dan'</span>, <span class="st">'bill'</span>, <span class="st">'(1)_chris'</span>]) <span class="op">==</span> <span class="st">'(2)_chris'</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> make_unique(<span class="st">'chris'</span>, <span class="bu">set</span>([<span class="st">'chris'</span>, <span class="st">'dan'</span>, <span class="st">'bill'</span>, <span class="st">'(1)_chris'</span>])) <span class="op">==</span> <span class="st">'(2)_chris'</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> make_unique(<span class="st">'a'</span>, {<span class="st">'a'</span>: <span class="dv">1</span>, <span class="st">'b'</span>: <span class="dv">2</span>, <span class="st">'c'</span>: <span class="dv">3</span>}) <span class="op">==</span> <span class="st">'(1)_a'</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> make_unique(<span class="st">'d'</span>, {<span class="st">'a'</span>: <span class="dv">1</span>, <span class="st">'b'</span>: <span class="dv">2</span>, <span class="st">'c'</span>: <span class="dv">3</span>}) <span class="op">==</span> <span class="st">'d'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> make_unique_path(path):  </span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Returns path with prefix '(n)_' before the last element in </span></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="co">    path if it is a duplicate. </span></span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a>    pre_path, file_name <span class="op">=</span> os.path.split(path)</span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>    file_name <span class="op">=</span> make_unique(file_name, os.listdir(pre_path <span class="kw">or</span> <span class="st">'.'</span>))</span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> os.path.join(pre_path, file_name)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L66" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="make_unique_path" class="level3">
<h3 class="anchored" data-anchor-id="make_unique_path">make_unique_path</h3>
<blockquote class="blockquote">
<pre><code> make_unique_path (path)</code></pre>
</blockquote>
<p>Returns path with prefix ’(n)_’ before the last element in path if it is a duplicate.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>os.makedirs(<span class="st">'tmp'</span>, exist_ok<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(make_unique_path(<span class="st">'tmp/tmp.csv'</span>))</span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="bu">open</span>(<span class="st">'tmp/tmp.csv'</span>, <span class="st">'w'</span>).close()</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(make_unique_path(<span class="st">'tmp/tmp.csv'</span>))</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>shutil.rmtree(<span class="st">'tmp'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>tmp/tmp.csv
tmp/(1)_tmp.csv</code></pre>
</div>
</div>
</section>
<section id="saving-and-loading-pandas-dataframes" class="level3">
<h3 class="anchored" data-anchor-id="saving-and-loading-pandas-dataframes">Saving and loading pandas dataframes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> save_file(df: pd.DataFrame, </span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>              path: <span class="bu">str</span>, </span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>              usecols: <span class="bu">list</span><span class="op">=</span><span class="va">None</span>,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>              save_index: <span class="bu">bool</span><span class="op">=</span><span class="va">False</span>, </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>              save_dtypes: <span class="bu">bool</span><span class="op">=</span><span class="va">True</span>, </span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>              pickle: <span class="bu">bool</span><span class="op">=</span><span class="va">False</span>) <span class="op">-&gt;</span> <span class="va">None</span>:</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Saves `df` to `path` with dtypes as top column if `save_dtypes` </span></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a><span class="co">    is set to True. Load a files in this structure with `load_file`</span></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> pickle: </span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>        usecols <span class="op">=</span> usecols <span class="cf">if</span> usecols <span class="cf">else</span> <span class="bu">list</span>(df)</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a>        path_dir <span class="op">=</span> os.path.split(path)[<span class="dv">0</span>] <span class="cf">if</span> path.endswith(<span class="st">'.csv'</span>) <span class="cf">else</span> path <span class="co"># For M5 project maintenence</span></span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> col <span class="kw">in</span> <span class="bu">list</span>(df): </span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>            df[[col]].to_pickle(os.path.join(path_dir, col <span class="op">+</span> <span class="st">'.pkl'</span>))</span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> </span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>    path <span class="op">=</span> make_unique_path(path)</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> save_dtypes:</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>        df_tmp <span class="op">=</span> df.iloc[[<span class="dv">0</span>], :]</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> usecols: df_tmp <span class="op">=</span> df_tmp.loc[:, usecols]</span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> save_index: </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>            df_tmp.reset_index(inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>        df_dtypes <span class="op">=</span> df_tmp.dtypes.to_frame().T</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>        df_dtypes.to_csv(path, index<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a>        df.to_csv(path, mode<span class="op">=</span><span class="st">'a'</span>, index<span class="op">=</span>save_index, header<span class="op">=</span><span class="va">False</span>, </span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a>                  columns<span class="op">=</span>usecols)</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>: </span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>        df.to_csv(path, index<span class="op">=</span>save_index, columns<span class="op">=</span>usecols)</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> load_file(path: <span class="bu">str</span>, load_dtypes<span class="op">=</span><span class="va">True</span>, usecols: <span class="bu">list</span><span class="op">=</span><span class="va">None</span>) <span class="op">-&gt;</span> pd.DataFrame:</span>
<span id="cb17-31"><a href="#cb17-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Loads a file into a DataFrame from `path` with dtypes </span></span>
<span id="cb17-32"><a href="#cb17-32" aria-hidden="true" tabindex="-1"></a><span class="co">    taken from the top column if `load_dtypes` is set to True. </span></span>
<span id="cb17-33"><a href="#cb17-33" aria-hidden="true" tabindex="-1"></a><span class="co">    Loads a files in the structure created with `save_file`.</span></span>
<span id="cb17-34"><a href="#cb17-34" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb17-35"><a href="#cb17-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> path.endswith(<span class="st">'pkl'</span>): </span>
<span id="cb17-36"><a href="#cb17-36" aria-hidden="true" tabindex="-1"></a>        df <span class="op">=</span> pd.read_pickle(path)</span>
<span id="cb17-37"><a href="#cb17-37" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> df[usecols] <span class="cf">if</span> usecols <span class="cf">else</span> df</span>
<span id="cb17-38"><a href="#cb17-38" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-39"><a href="#cb17-39" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> load_dtypes:</span>
<span id="cb17-40"><a href="#cb17-40" aria-hidden="true" tabindex="-1"></a>        dtypes <span class="op">=</span> pd.read_csv(path, nrows<span class="op">=</span><span class="dv">1</span>).iloc[<span class="dv">0</span>].to_dict()</span>
<span id="cb17-41"><a href="#cb17-41" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.read_csv(path, skiprows<span class="op">=</span>[<span class="dv">1</span>], dtype<span class="op">=</span>dtypes, usecols<span class="op">=</span>usecols)</span>
<span id="cb17-42"><a href="#cb17-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb17-43"><a href="#cb17-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> pd.read_csv(path, usecols<span class="op">=</span>usecols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L104" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="load_file" class="level3">
<h3 class="anchored" data-anchor-id="load_file">load_file</h3>
<blockquote class="blockquote">
<pre><code> load_file (path:str, load_dtypes=True, usecols:list=None)</code></pre>
</blockquote>
<p>Loads a file into a DataFrame from <code>path</code> with dtypes taken from the top column if <code>load_dtypes</code> is set to True. Loads a files in the structure created with <a href="https://chrisrichardmiles.github.io/chrisrichardmiles/core.html#save_file"><code>save_file</code></a>.</p>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L75" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="save_file" class="level3">
<h3 class="anchored" data-anchor-id="save_file">save_file</h3>
<blockquote class="blockquote">
<pre><code> save_file (df:pandas.core.frame.DataFrame, path:str, usecols:list=None,
            save_index:bool=False, save_dtypes:bool=True,
            pickle:bool=False)</code></pre>
</blockquote>
<p>Saves <code>df</code> to <code>path</code> with dtypes as top column if <code>save_dtypes</code> is set to True. Load a files in this structure with <a href="https://chrisrichardmiles.github.io/chrisrichardmiles/core.html#load_file"><code>load_file</code></a></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Example</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'a'</span>: [<span class="dv">1</span>, <span class="dv">2</span>], <span class="st">'b'</span>: [<span class="st">'foo'</span>, <span class="st">'bar'</span>], <span class="st">'c'</span>: [<span class="fl">1.2</span>, <span class="fl">3.3</span>]})</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> df.astype(<span class="bu">dict</span>(<span class="bu">zip</span>([<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], [<span class="st">'int32'</span>, <span class="st">'category'</span>, np.float16])))</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Saving the the dataframe to csv with the dtypes'</span>)</span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>display(df.dtypes)</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>save_file(df, <span class="st">'tmp.csv'</span>, pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'Now the csv has the datatypes as the top line when we read it in'</span>)</span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>display(pd.read_csv(<span class="st">'tmp.csv'</span>))</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="st">'We can use `load_file` to read in the csv with the right dtypes'</span>)</span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>display(load_file(<span class="st">'tmp.csv'</span>))</span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a>display(load_file(<span class="st">'tmp.csv'</span>).dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Saving the the dataframe to csv with the dtypes</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>a       int32
b    category
c     float16
dtype: object</code></pre>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Now the csv has the datatypes as the top line when we read it in</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>int32</td>
      <td>category</td>
      <td>float16</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>foo</td>
      <td>1.2</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>bar</td>
      <td>3.3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>We can use `load_file` to read in the csv with the right dtypes</code></pre>
</div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>foo</td>
      <td>1.200195</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>bar</td>
      <td>3.300781</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>a       int32
b    category
c     float16
dtype: object</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>save_file(df, <span class="st">'.'</span>, pickle<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>display(pd.concat([load_file(x <span class="op">+</span> <span class="st">'.pkl'</span>) <span class="cf">for</span> x <span class="kw">in</span> <span class="st">'abc'</span>], axis<span class="op">=</span><span class="dv">1</span>))</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>rm a.pkl b.pkl c.pkl</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>a</th>
      <th>b</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>foo</td>
      <td>1.200195</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>bar</td>
      <td>3.300781</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>save_file(df, <span class="st">'tmp2.csv'</span>, usecols<span class="op">=</span>[<span class="st">'a'</span>, <span class="st">'c'</span>], save_index<span class="op">=</span><span class="va">True</span>, pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>load_file(<span class="st">'tmp2.csv'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>index</th>
      <th>a</th>
      <th>c</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>1</td>
      <td>1.200195</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>3.300781</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>rm tmp<span class="op">*</span>.csv</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values." class="level3">
<h3 class="anchored" data-anchor-id="making-a-dictionary-and-json-with-file-names-as-keys-and-list-of-column-names-as-values.">Making a dictionary and json with file names as keys and list of column names as values.</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(<span class="st">'.'</span>)):</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="bu">file</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>.devcontainer.json
.git
.gitattributes
.gitconfig
.github
.gitignore
.ipynb_checkpoints
.pypirc
00_core.ipynb
CONTRIBUTING.md
LICENSE
MANIFEST.in
Makefile
README.md
chrisrichardmiles
chrisrichardmiles.egg-info
data
docker-compose.yml
docs
index.ipynb
log.log
projects
settings.ini
setup.py
small_data</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_file_cols_dict(path: <span class="bu">str</span><span class="op">=</span><span class="st">'.'</span>, </span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>                       path_json: <span class="bu">str</span><span class="op">=</span><span class="st">''</span>, </span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>                       ignore_cols: <span class="bu">list</span><span class="op">=</span>[<span class="st">'index'</span>]):</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Explores `path` and returns a dictionary of file names and their columns</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a><span class="co">    for each file in `path`. Only file names that end with </span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a><span class="co">    '.csv' and '.pkl' will be considered. Pickle file names</span></span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a><span class="co">    will go in the 'pickles' key of the returned dictionary.</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a><span class="co">    Csv files will see their file name saved as a key with </span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co">    a list of their column names saved as the corresponding </span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a><span class="co">    value.</span></span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    d <span class="op">=</span> {}</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> <span class="bu">file</span> <span class="kw">in</span> <span class="bu">sorted</span>(os.listdir(path)): </span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">'.csv'</span>): </span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a>            cols <span class="op">=</span> pd.read_csv(os.path.join(path, <span class="bu">file</span>), nrows<span class="op">=</span><span class="dv">0</span>).columns.tolist()</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>            d[<span class="bu">file</span>] <span class="op">=</span> [c <span class="cf">for</span> c <span class="kw">in</span> cols <span class="cf">if</span> c <span class="kw">not</span> <span class="kw">in</span> ignore_cols]</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">file</span>.endswith(<span class="st">'.pkl'</span>): </span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>            d.setdefault(<span class="st">'pickles'</span>, []).append(<span class="bu">file</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> path_json: </span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>        <span class="cf">with</span> <span class="bu">open</span>(path_json, <span class="st">'w'</span>) <span class="im">as</span> path_json: </span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>            json.dump(d, path_json, indent<span class="op">=</span><span class="dv">0</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> d</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a><span class="at">@call_parse</span></span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> fe_dict(path: Param(<span class="st">'path to directory with files'</span>, <span class="bu">str</span>)<span class="op">=</span><span class="st">'data/features'</span>, </span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>            path_json: Param(<span class="st">'path to json for saving dict'</span>, <span class="bu">str</span>)<span class="op">=</span><span class="st">'fe_dict.json'</span>):</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>    get_file_cols_dict(path, path_json)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L145" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="fe_dict" class="level3">
<h3 class="anchored" data-anchor-id="fe_dict">fe_dict</h3>
<blockquote class="blockquote">
<pre><code> fe_dict (path:str&lt;pathtodirectorywithfiles&gt;='data/features',
          path_json:str&lt;pathtojsonforsavingdict&gt;='fe_dict.json')</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L120" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_file_cols_dict" class="level3">
<h3 class="anchored" data-anchor-id="get_file_cols_dict">get_file_cols_dict</h3>
<blockquote class="blockquote">
<pre><code> get_file_cols_dict (path:str='.', path_json:str='',
                     ignore_cols:list=['index'])</code></pre>
</blockquote>
<p>Explores <code>path</code> and returns a dictionary of file names and their columns for each file in <code>path</code>. Only file names that end with ‘.csv’ and ‘.pkl’ will be considered. Pickle file names will go in the ‘pickles’ key of the returned dictionary. Csv files will see their file name saved as a key with a list of their column names saved as the corresponding value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df1 <span class="op">=</span> pd.DataFrame({<span class="st">'feat_1'</span>: [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">4</span>], <span class="st">'feat_2'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>], <span class="st">'feat_3'</span>: [<span class="dv">1</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>]})</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>df2 <span class="op">=</span> pd.DataFrame({<span class="st">'shift_feat_4'</span>: [<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">2</span>,<span class="dv">4</span>], <span class="st">'shift_feat_5'</span>: [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">9</span>], <span class="st">'shift_feat_6'</span>: [<span class="dv">1</span>,<span class="dv">9</span>,<span class="dv">3</span>,<span class="dv">3</span>]})</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>df3 <span class="op">=</span> pd.DataFrame({<span class="st">'feat_7'</span>: [<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">4</span>], <span class="st">'feat_8'</span>: [<span class="dv">7</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>], <span class="st">'feat_9'</span>: [<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="dv">3</span>]})</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>df4 <span class="op">=</span> pd.DataFrame({<span class="st">'feat_10'</span>: [<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">2</span>,<span class="dv">4</span>], <span class="st">'feat_11'</span>: [<span class="dv">7</span>,<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">3</span>], <span class="st">'feat_12'</span>: [<span class="dv">1</span>,<span class="dv">7</span>,<span class="dv">3</span>,<span class="dv">3</span>], </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>                    <span class="st">'feat_13'</span>: [<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>, <span class="st">'d'</span>]})</span>
<span id="cb34-6"><a href="#cb34-6" aria-hidden="true" tabindex="-1"></a>df4.feat_10 <span class="op">=</span> df4.feat_10.astype(<span class="st">'int8'</span>)</span>
<span id="cb34-7"><a href="#cb34-7" aria-hidden="true" tabindex="-1"></a>df4.feat_13 <span class="op">=</span> df4.feat_13.astype(<span class="st">'category'</span>)</span>
<span id="cb34-8"><a href="#cb34-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb34-9"><a href="#cb34-9" aria-hidden="true" tabindex="-1"></a>save_file(df1, <span class="st">'features_1.csv'</span>, pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-10"><a href="#cb34-10" aria-hidden="true" tabindex="-1"></a>save_file(df2, <span class="st">'shift_features_2.csv'</span>, pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-11"><a href="#cb34-11" aria-hidden="true" tabindex="-1"></a>save_file(df3, <span class="st">'features_3.csv'</span>, pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-12"><a href="#cb34-12" aria-hidden="true" tabindex="-1"></a>save_file(df4, <span class="st">'features_4.csv'</span>, save_index<span class="op">=</span><span class="va">True</span>, pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb34-13"><a href="#cb34-13" aria-hidden="true" tabindex="-1"></a>save_file(df3, <span class="st">'features_3_less_cols.csv'</span>, usecols<span class="op">=</span>[<span class="st">'feat_7'</span>], pickle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>get_file_cols_dict(<span class="st">'.'</span>, path_json<span class="op">=</span><span class="st">'tmp_features.json'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'features_1.csv': ['feat_1', 'feat_2', 'feat_3'],
 'features_3.csv': ['feat_7', 'feat_8', 'feat_9'],
 'features_3_less_cols.csv': ['feat_7'],
 'features_4.csv': ['feat_10', 'feat_11', 'feat_12', 'feat_13'],
 'shift_features_2.csv': ['shift_feat_4', 'shift_feat_5', 'shift_feat_6']}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>get_file_cols_dict(<span class="st">'.'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>{'features_1.csv': ['feat_1', 'feat_2', 'feat_3'],
 'features_3.csv': ['feat_7', 'feat_8', 'feat_9'],
 'features_3_less_cols.csv': ['feat_7'],
 'features_4.csv': ['feat_10', 'feat_11', 'feat_12', 'feat_13'],
 'shift_features_2.csv': ['shift_feat_4', 'shift_feat_5', 'shift_feat_6']}</code></pre>
</div>
</div>
</section>
<section id="loading-features" class="level3">
<h3 class="anchored" data-anchor-id="loading-features">Loading features</h3>
<p>Now we can easily load in our features with the correct data types</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>load_features(<span class="st">'.'</span>, <span class="st">'tmp_features.json'</span>, pickle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>b</td>
      <td>9</td>
      <td>1</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>c</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>d</td>
      <td>4</td>
      <td>9</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> load_features(<span class="st">'.'</span>, <span class="st">'tmp_features.json'</span>, features<span class="op">=</span>[<span class="st">'feat_3'</span>, <span class="st">'feat_10'</span>, <span class="st">'feat_13'</span>], pickle<span class="op">=</span><span class="va">False</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>display(df)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>display(df.dtypes)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>feat_3</th>
      <th>feat_10</th>
      <th>feat_13</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>a</td>
    </tr>
    <tr>
      <th>1</th>
      <td>4</td>
      <td>7</td>
      <td>b</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2</td>
      <td>c</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3</td>
      <td>4</td>
      <td>d</td>
    </tr>
  </tbody>
</table>
</div>
</div>
<div class="cell-output cell-output-display">
<pre><code>feat_3        int64
feat_10        int8
feat_13    category
dtype: object</code></pre>
</div>
</div>
<p>Sometimes we need to shift the index so that our lag features are in the correct allignment.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>load_features(<span class="st">'.'</span>, <span class="st">'tmp_features.json'</span>, shift_index<span class="op">=</span><span class="dv">1</span>, pickle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>a</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2.0</td>
      <td>1.0</td>
      <td>4.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>7.0</td>
      <td>b</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>c</td>
      <td>9.0</td>
      <td>1.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>4.0</td>
      <td>4.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>d</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>4.0</td>
      <td>9.0</td>
      <td>3.0</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>Sometimes we are loading features for a subset of the data so we only need to load the rows associated with certain indexes.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>load_features(<span class="st">'.'</span>, <span class="st">'tmp_features.json'</span>, shift_index<span class="op">=</span><span class="dv">1</span>, reindex_with<span class="op">=</span>[<span class="dv">1</span>, <span class="dv">3</span>], pickle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>b</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>d</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<p>We can use a copy of the feature module, easily comment out features we don’t want, and use this to load features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>shutil.copyfile(<span class="st">'tmp_features.json'</span>, <span class="st">'tmp_features_1.json'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'tmp_features_1.json'</code></pre>
</div>
</div>
<p>open <code>tmp_features_1.json</code> and delete features</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>cat tmp_features_1.json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>{
"features_1.csv": [
"feat_1",
"feat_2",
"feat_3"
],
"features_3.csv": [
"feat_7",
"feat_8",
"feat_9"
],
"features_3_less_cols.csv": [
"feat_7"
],
"features_4.csv": [
"feat_10",
"feat_11",
"feat_12",
"feat_13"
],
"shift_features_2.csv": [
"shift_feat_4",
"shift_feat_5",
"shift_feat_6"
]
}</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>load_features(<span class="st">'.'</span>, <span class="st">'tmp_features_1.json'</span>, pickle<span class="op">=</span><span class="va">False</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">

<div>

<table class="dataframe table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
      <th>feat_1</th>
      <th>feat_2</th>
      <th>feat_3</th>
      <th>feat_7</th>
      <th>feat_8</th>
      <th>feat_9</th>
      <th>feat_7</th>
      <th>feat_10</th>
      <th>feat_11</th>
      <th>feat_12</th>
      <th>feat_13</th>
      <th>shift_feat_4</th>
      <th>shift_feat_5</th>
      <th>shift_feat_6</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>7</td>
      <td>1</td>
      <td>a</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>1</td>
      <td>4</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>7</td>
      <td>7</td>
      <td>1</td>
      <td>7</td>
      <td>b</td>
      <td>9</td>
      <td>1</td>
      <td>9</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>c</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>3</td>
      <td>3</td>
      <td>d</td>
      <td>4</td>
      <td>9</td>
      <td>3</td>
    </tr>
  </tbody>
</table>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>rm <span class="op">*</span>.csv</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="op">!</span>rm tmp<span class="op">*</span>.json</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="speed-and-memory-functions" class="level2">
<h2 class="anchored" data-anchor-id="speed-and-memory-functions">Speed and memory functions</h2>
<section id="paralel-runs" class="level3">
<h3 class="anchored" data-anchor-id="paralel-runs">Paralel runs</h3>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L240" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="pool_func" class="level3">
<h3 class="anchored" data-anchor-id="pool_func">pool_func</h3>
<blockquote class="blockquote">
<pre><code> pool_func (function, input_list:list, verbose=False, n_cpu=99)</code></pre>
</blockquote>
<p>Uses the Pool function from the package ‘multiprocessing’ to run <code>function</code> over the list <code>input_list</code>. The <code>function</code> should only take</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> f(x): <span class="cf">return</span> x <span class="op">*</span> <span class="dv">5</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>pool_func(f, <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">20</span>)), <span class="va">True</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>#############################################
Pooling function: 
f
16 of 16 cpus used
Number of function calls:  20
Time taken: 0.0 minutes</code></pre>
</div>
<div class="cell-output cell-output-display">
<pre><code>[0, 5, 10, 15, 20, 25, 30, 35, 40, 45, 50, 55, 60, 65, 70, 75, 80, 85, 90, 95]</code></pre>
</div>
</div>
</section>
<section id="saving-memory" class="level3">
<h3 class="anchored" data-anchor-id="saving-memory">Saving memory</h3>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L267" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="reduce_mem_usage" class="level3">
<h3 class="anchored" data-anchor-id="reduce_mem_usage">reduce_mem_usage</h3>
<blockquote class="blockquote">
<pre><code> reduce_mem_usage (df, verbose=True)</code></pre>
</blockquote>
<p>Converts numeric columns to smallest datatype that preserves information</p>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L298" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="merge_by_concat" class="level3">
<h3 class="anchored" data-anchor-id="merge_by_concat">merge_by_concat</h3>
<blockquote class="blockquote">
<pre><code> merge_by_concat (df1, df2, merge_on)</code></pre>
</blockquote>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L320" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="sizeof_fmt" class="level3">
<h3 class="anchored" data-anchor-id="sizeof_fmt">sizeof_fmt</h3>
<blockquote class="blockquote">
<pre><code> sizeof_fmt (num, suffix='B')</code></pre>
</blockquote>
<p>Reformats <code>num</code>, which is num bytes</p>
<pre><code>/opt/hostedtoolcache/Python/3.10.7/x64/lib/python3.10/site-packages/fastcore/docscrape.py:225: UserWarning: Unknown section Explanation Of Code
  else: warn(msg)</code></pre>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L307" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="get_memory_usage" class="level3">
<h3 class="anchored" data-anchor-id="get_memory_usage">get_memory_usage</h3>
<blockquote class="blockquote">
<pre><code> get_memory_usage ()</code></pre>
</blockquote>
<p>Returns RAM usage in gigabytes</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>get_memory_usage()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>0.14</code></pre>
</div>
</div>
<hr>
<p><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/blob/master/chrisrichardmiles/core.py#L329" target="_blank" style="float:right; font-size:smaller">source</a></p>
</section>
<section id="time_taken" class="level3">
<h3 class="anchored" data-anchor-id="time_taken">time_taken</h3>
<blockquote class="blockquote">
<pre><code> time_taken (start_time:float=0, time_elapsed:float=None)</code></pre>
</blockquote>
<p>Returns a string with the time elapsed from <code>start_time</code> in a nice format. If <code>time_elapsed</code> is provided, we ignore the start time.</p>
<p><code>start_time</code> should come from by calling the time module: start_time = time.time()</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>start_time <span class="op">=</span> time.time()</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>time.sleep(<span class="dv">2</span>)</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>time_taken(start_time)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'Time taken: 2 seconds'</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>time_taken(time_elapsed<span class="op">=</span><span class="dv">3666</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>'Time taken: 1 hours 1 minutes 6 seconds'</code></pre>
</div>
</div>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>