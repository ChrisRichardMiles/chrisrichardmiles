---

title: Brief EDA  


keywords: fastai
sidebar: home_sidebar



nb_path: "projects/m5/01_brief_eda.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: projects/m5/01_brief_eda.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">PATH_DATA</span> <span class="o">=</span> <span class="s1">&#39;data&#39;</span>
<span class="n">PATH_DATA_RAW</span> <span class="o">=</span> <span class="s1">&#39;data/raw&#39;</span>
<span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">PATH_DATA_RAW</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>[&#39;sample_submission.csv&#39;,
 &#39;sell_prices.csv&#39;,
 &#39;calendar.csv&#39;,
 &#39;sales_train_evaluation.csv&#39;]</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># PATH_DATA = &#39;data&#39;</span>
<span class="c1"># PATH_DATA_RAW = &#39;data/raw&#39;</span>
<span class="c1"># os.listdir(PATH_DATA_RAW)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">chunks</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_DATA_RAW</span><span class="p">,</span> <span class="s1">&#39;sales_train_evaluation.csv&#39;</span><span class="p">),</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">df_stv</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">chunks</span><span class="p">))</span> <span class="c1"># Safe for low RAM situation</span>
<span class="n">df_cal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_DATA_RAW</span><span class="p">,</span> <span class="s1">&#39;calendar.csv&#39;</span><span class="p">))</span>
<span class="n">df_prices</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_DATA_RAW</span><span class="p">,</span> <span class="s1">&#39;sell_prices.csv&#39;</span><span class="p">))</span>
<span class="n">df_ss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">PATH_DATA_RAW</span><span class="p">,</span> <span class="s1">&#39;sample_submission.csv&#39;</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>sales_train_evaluation</strong>:
We have six hierarchical categores and 1941 days of sales data for each of the 30490 items</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_stv</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_stv</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>item_id</th>
      <th>dept_id</th>
      <th>cat_id</th>
      <th>store_id</th>
      <th>state_id</th>
      <th>d_1802</th>
      <th>d_1803</th>
      <th>d_1804</th>
      <th>d_1805</th>
      <th>...</th>
      <th>d_1932</th>
      <th>d_1933</th>
      <th>d_1934</th>
      <th>d_1935</th>
      <th>d_1936</th>
      <th>d_1937</th>
      <th>d_1938</th>
      <th>d_1939</th>
      <th>d_1940</th>
      <th>d_1941</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FOODS_1_001_CA_1_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_1</td>
      <td>CA</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>FOODS_1_001_CA_2_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_2</td>
      <td>CA</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FOODS_1_001_CA_3_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_3</td>
      <td>CA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
    </tr>
    <tr>
      <th>3</th>
      <td>FOODS_1_001_CA_4_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_4</td>
      <td>CA</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FOODS_1_001_TX_1_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>TX_1</td>
      <td>TX</td>
      <td>1</td>
      <td>0</td>
      <td>2</td>
      <td>1</td>
      <td>...</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
      <td>5</td>
      <td>0</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 146 columns</p>
</div></div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 70 entries, 0 to 69
Columns: 146 entries, id to d_1941
dtypes: int64(140), object(6)
memory usage: 80.0+ KB
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>None</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>calendar</strong> gives us some date information. This includes special events like holidays and information about SNAP (ebt foodstamps) acceptance for each day of the training and evaluation periods.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_cal</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_cal</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>wm_yr_wk</th>
      <th>weekday</th>
      <th>wday</th>
      <th>month</th>
      <th>year</th>
      <th>d</th>
      <th>event_name_1</th>
      <th>event_type_1</th>
      <th>event_name_2</th>
      <th>event_type_2</th>
      <th>snap_CA</th>
      <th>snap_TX</th>
      <th>snap_WI</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2016-01-02</td>
      <td>11549</td>
      <td>Saturday</td>
      <td>1</td>
      <td>1</td>
      <td>2016</td>
      <td>d_1800</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2016-01-03</td>
      <td>11549</td>
      <td>Sunday</td>
      <td>2</td>
      <td>1</td>
      <td>2016</td>
      <td>d_1801</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2016-01-04</td>
      <td>11549</td>
      <td>Monday</td>
      <td>3</td>
      <td>1</td>
      <td>2016</td>
      <td>d_1802</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2016-01-05</td>
      <td>11549</td>
      <td>Tuesday</td>
      <td>4</td>
      <td>1</td>
      <td>2016</td>
      <td>d_1803</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2016-01-06</td>
      <td>11549</td>
      <td>Wednesday</td>
      <td>5</td>
      <td>1</td>
      <td>2016</td>
      <td>d_1804</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>1</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 170 entries, 0 to 169
Data columns (total 14 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   date          170 non-null    object
 1   wm_yr_wk      170 non-null    int64 
 2   weekday       170 non-null    object
 3   wday          170 non-null    int64 
 4   month         170 non-null    int64 
 5   year          170 non-null    int64 
 6   d             170 non-null    object
 7   event_name_1  18 non-null     object
 8   event_type_1  18 non-null     object
 9   event_name_2  1 non-null      object
 10  event_type_2  1 non-null      object
 11  snap_CA       170 non-null    int64 
 12  snap_TX       170 non-null    int64 
 13  snap_WI       170 non-null    int64 
dtypes: int64(7), object(7)
memory usage: 18.7+ KB
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>None</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>sell_prices</strong> gives the weekly price for each store/item combination.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_prices</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_prices</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>store_id</th>
      <th>item_id</th>
      <th>wm_yr_wk</th>
      <th>sell_price</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>CA_1</td>
      <td>HOBBIES_1_001</td>
      <td>11549</td>
      <td>8.26</td>
    </tr>
    <tr>
      <th>1</th>
      <td>CA_1</td>
      <td>HOBBIES_1_001</td>
      <td>11550</td>
      <td>8.26</td>
    </tr>
    <tr>
      <th>2</th>
      <td>CA_1</td>
      <td>HOBBIES_1_001</td>
      <td>11551</td>
      <td>8.26</td>
    </tr>
    <tr>
      <th>3</th>
      <td>CA_1</td>
      <td>HOBBIES_1_001</td>
      <td>11552</td>
      <td>8.26</td>
    </tr>
    <tr>
      <th>4</th>
      <td>CA_1</td>
      <td>HOBBIES_1_001</td>
      <td>11601</td>
      <td>8.26</td>
    </tr>
  </tbody>
</table>
</div></div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 1750 entries, 0 to 1749
Data columns (total 4 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   store_id    1750 non-null   object 
 1   item_id     1750 non-null   object 
 2   wm_yr_wk    1750 non-null   int64  
 3   sell_price  1750 non-null   float64
dtypes: float64(1), int64(1), object(2)
memory usage: 54.8+ KB
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>None</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>sample_submission</strong> shows the expected format of a submission. Each item/store combination will have a row with the 28 day forecast as the columns. We submit predictions for the validation period and the test period in the same file.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">display</span><span class="p">(</span><span class="n">df_ss</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">display</span><span class="p">(</span><span class="n">df_ss</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>F1</th>
      <th>F2</th>
      <th>F3</th>
      <th>F4</th>
      <th>F5</th>
      <th>F6</th>
      <th>F7</th>
      <th>F8</th>
      <th>F9</th>
      <th>...</th>
      <th>F19</th>
      <th>F20</th>
      <th>F21</th>
      <th>F22</th>
      <th>F23</th>
      <th>F24</th>
      <th>F25</th>
      <th>F26</th>
      <th>F27</th>
      <th>F28</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>HOBBIES_1_001_CA_1_validation</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>HOBBIES_2_001_CA_1_validation</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>HOUSEHOLD_1_001_CA_1_validation</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>HOUSEHOLD_2_001_CA_1_validation</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>FOODS_1_001_CA_1_validation</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 29 columns</p>
</div></div>

</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 140 entries, 0 to 139
Data columns (total 29 columns):
 #   Column  Non-Null Count  Dtype 
---  ------  --------------  ----- 
 0   id      140 non-null    object
 1   F1      140 non-null    int64 
 2   F2      140 non-null    int64 
 3   F3      140 non-null    int64 
 4   F4      140 non-null    int64 
 5   F5      140 non-null    int64 
 6   F6      140 non-null    int64 
 7   F7      140 non-null    int64 
 8   F8      140 non-null    int64 
 9   F9      140 non-null    int64 
 10  F10     140 non-null    int64 
 11  F11     140 non-null    int64 
 12  F12     140 non-null    int64 
 13  F13     140 non-null    int64 
 14  F14     140 non-null    int64 
 15  F15     140 non-null    int64 
 16  F16     140 non-null    int64 
 17  F17     140 non-null    int64 
 18  F18     140 non-null    int64 
 19  F19     140 non-null    int64 
 20  F20     140 non-null    int64 
 21  F21     140 non-null    int64 
 22  F22     140 non-null    int64 
 23  F23     140 non-null    int64 
 24  F24     140 non-null    int64 
 25  F25     140 non-null    int64 
 26  F26     140 non-null    int64 
 27  F27     140 non-null    int64 
 28  F28     140 non-null    int64 
dtypes: int64(28), object(1)
memory usage: 31.8+ KB
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea ">
<pre>None</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Saving-small-data">Saving small data<a class="anchor-link" href="#Saving-small-data"> </a></h2><p>To utilize continuous integration on github, and also use nbdev to test all of our code, we will create a truncated version of our files. They need to be less than 100MB to fit on github and allow fast tests.</p>
<p>Lets only save the last 28 * 6 days of sales data for one item from each dept_id / store_id combination.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df_len</span> <span class="o">=</span> <span class="n">df_stv</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">df_stv_small</span> <span class="o">=</span> <span class="n">df_stv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">df_len</span> <span class="o">-</span> <span class="mi">28</span> <span class="o">*</span> <span class="mi">5</span><span class="p">,</span> <span class="n">df_len</span><span class="p">))]</span>
<span class="n">original_col_order</span> <span class="o">=</span> <span class="n">df_stv_small</span><span class="o">.</span><span class="n">columns</span>
<span class="n">df_stv_small</span> <span class="o">=</span> <span class="n">df_stv_small</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s1">&#39;dept_id&#39;</span><span class="p">,</span> <span class="s1">&#39;store_id&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">first</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()[</span><span class="n">original_col_order</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Now there are only </span><span class="si">{</span><span class="n">df_stv_small</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> rows and </span><span class="si">{</span><span class="n">df_stv_small</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1"> columns&#39;</span><span class="p">)</span>
<span class="n">df_stv_small</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Now there are only 70 rows and 146 columns
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>item_id</th>
      <th>dept_id</th>
      <th>cat_id</th>
      <th>store_id</th>
      <th>state_id</th>
      <th>d_1802</th>
      <th>d_1803</th>
      <th>d_1804</th>
      <th>d_1805</th>
      <th>...</th>
      <th>d_1932</th>
      <th>d_1933</th>
      <th>d_1934</th>
      <th>d_1935</th>
      <th>d_1936</th>
      <th>d_1937</th>
      <th>d_1938</th>
      <th>d_1939</th>
      <th>d_1940</th>
      <th>d_1941</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>FOODS_1_001_CA_1_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_1</td>
      <td>CA</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>2</td>
      <td>3</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>FOODS_1_001_CA_2_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_2</td>
      <td>CA</td>
      <td>1</td>
      <td>6</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>1</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>FOODS_1_001_CA_3_evaluation</td>
      <td>FOODS_1_001</td>
      <td>FOODS_1</td>
      <td>FOODS</td>
      <td>CA_3</td>
      <td>CA</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>0</td>
      <td>...</td>
      <td>1</td>
      <td>2</td>
      <td>2</td>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>0</td>
      <td>3</td>
      <td>2</td>
      <td>2</td>
    </tr>
  </tbody>
</table>
<p>3 rows Ã— 146 columns</p>
</div></div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the small calendar file, we only need data for days greater than or equal to 1802</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">min_wm_yr_wk</span> <span class="o">=</span> <span class="n">df_cal</span><span class="p">[</span><span class="n">df_cal</span><span class="o">.</span><span class="n">d</span> <span class="o">==</span> <span class="s1">&#39;d_1802&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">wm_yr_wk</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">df_cal_small</span> <span class="o">=</span> <span class="n">df_cal</span><span class="p">[</span><span class="n">df_cal</span><span class="o">.</span><span class="n">wm_yr_wk</span> <span class="o">&gt;=</span> <span class="n">min_wm_yr_wk</span><span class="p">]</span>
<span class="n">df_cal_small</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 170 entries, 0 to 169
Data columns (total 14 columns):
 #   Column        Non-Null Count  Dtype 
---  ------        --------------  ----- 
 0   date          170 non-null    object
 1   wm_yr_wk      170 non-null    int64 
 2   weekday       170 non-null    object
 3   wday          170 non-null    int64 
 4   month         170 non-null    int64 
 5   year          170 non-null    int64 
 6   d             170 non-null    object
 7   event_name_1  18 non-null     object
 8   event_type_1  18 non-null     object
 9   event_name_2  1 non-null      object
 10  event_type_2  1 non-null      object
 11  snap_CA       170 non-null    int64 
 12  snap_TX       170 non-null    int64 
 13  snap_WI       170 non-null    int64 
dtypes: int64(7), object(7)
memory usage: 19.9+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>For the small prices file, we can filter using the items we have in df_stv_small, and the minimun wm_yr_wk we just made.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item_mask</span> <span class="o">=</span> <span class="n">df_prices</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">df_stv_small</span><span class="o">.</span><span class="n">item_id</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
<span class="n">date_mask</span> <span class="o">=</span> <span class="n">df_prices</span><span class="o">.</span><span class="n">wm_yr_wk</span> <span class="o">&gt;=</span> <span class="n">min_wm_yr_wk</span>
<span class="n">df_prices_small</span> <span class="o">=</span> <span class="n">df_prices</span><span class="p">[</span><span class="n">item_mask</span> <span class="o">&amp;</span> <span class="n">date_mask</span><span class="p">]</span>
<span class="n">df_prices_small</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
Int64Index: 1750 entries, 0 to 1749
Data columns (total 4 columns):
 #   Column      Non-Null Count  Dtype  
---  ------      --------------  -----  
 0   store_id    1750 non-null   object 
 1   item_id     1750 non-null   object 
 2   wm_yr_wk    1750 non-null   int64  
 3   sell_price  1750 non-null   float64
dtypes: float64(1), int64(1), object(2)
memory usage: 68.4+ KB
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The sample submission should only have the items in df_stv_small</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">item_list</span> <span class="o">=</span> <span class="n">df_stv_small</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span> <span class="o">+</span> <span class="n">df_stv_small</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;evaluation&#39;</span><span class="p">,</span> <span class="s1">&#39;validation&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">df_ss_small</span> <span class="o">=</span> <span class="n">df_ss</span><span class="p">[</span><span class="n">df_ss</span><span class="o">.</span><span class="n">id</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">item_list</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s1">&#39;small_data/raw&#39;</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df_stv_small</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;small_data/raw&#39;</span><span class="p">,</span> <span class="s1">&#39;sales_train_evaluation.csv&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_cal_small</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;small_data/raw&#39;</span><span class="p">,</span> <span class="s1">&#39;calendar.csv&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_prices_small</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;small_data/raw&#39;</span><span class="p">,</span> <span class="s1">&#39;sell_prices.csv&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df_ss_small</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;small_data/raw&#39;</span><span class="p">,</span> <span class="s1">&#39;sample_submission.csv&#39;</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">nbdev.export</span> <span class="kn">import</span> <span class="n">notebook2script</span><span class="p">;</span> <span class="n">notebook2script</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Converted 00_core.ipynb.
Converted index.ipynb.
Converted 01_brief_eda.ipynb.
Converted 02_WRMSSE_metric.ipynb.
Converted 03_feature_engineering.ipynb.
Converted 04_out_of_stock_detection.ipynb.
Converted 05_custom_metric_and_loss_functions.ipynb.
Converted Training day-by-day models.ipynb.
Converted index.ipynb.
Converted scripts.ipynb.
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

