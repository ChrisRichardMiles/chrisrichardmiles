---

title: Train day-by-day models


keywords: fastai
sidebar: home_sidebar



nb_path: "projects/m5/05_training_day_by_day_models.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: projects/m5/05_training_day_by_day_models.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea "><style type='text/css'>
.datatable table.frame { margin-bottom: 0; }
.datatable table.frame thead { border-bottom: none; }
.datatable table.frame tr.coltypes td {  color: #FFFFFF;  line-height: 6px;  padding: 0 0.5em;}
.datatable .bool    { background: #DDDD99; }
.datatable .object  { background: #565656; }
.datatable .int     { background: #5D9E5D; }
.datatable .float   { background: #4040CC; }
.datatable .str     { background: #CC4040; }
.datatable .time    { background: #40CC40; }
.datatable .row_index {  background: var(--jp-border-color3);  border-right: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  font-size: 9px;}
.datatable .frame tbody td { text-align: left; }
.datatable .frame tr.coltypes .row_index {  background: var(--jp-border-color0);}
.datatable th:nth-child(2) { padding-left: 12px; }
.datatable .hellipsis {  color: var(--jp-cell-editor-border-color);}
.datatable .vellipsis {  background: var(--jp-layout-color0);  color: var(--jp-cell-editor-border-color);}
.datatable .na {  color: var(--jp-cell-editor-border-color);  font-size: 80%;}
.datatable .sp {  opacity: 0.25;}
.datatable .footer { font-size: 9px; }
.datatable .frame_dimensions {  background: var(--jp-border-color3);  border-top: 1px solid var(--jp-border-color0);  color: var(--jp-ui-font-color3);  display: inline-block;  opacity: 0.6;  padding: 1px 10px 1px 5px;}
</style>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>The autoreload extension is already loaded. To reload it, use:
  %reload_ext autoreload
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="load_cfg" class="doc_header"><code>load_cfg</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/m5/daily_models.py#L31" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>load_cfg</code>(<strong><code>path_cfg</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">hide</span>
<span class="n">cfg</span> <span class="o">=</span> <span class="n">load_cfg</span><span class="p">(</span><span class="s1">&#39;final_cfg.json&#39;</span><span class="p">)</span>
<span class="n">cfg</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;start_test&#39;: 1942,
 &#39;start_train&#39;: 140,
 &#39;days_to_predict&#39;: &#39;all&#39;,
 &#39;fobj&#39;: None,
 &#39;fobj_weight_col&#39;: &#39;total_scaled_weight&#39;,
 &#39;weight_hess&#39;: 1,
 &#39;feval&#39;: &#39;mse&#39;,
 &#39;feval_weight_col&#39;: &#39;scale&#39;,
 &#39;weight_col&#39;: None,
 &#39;lgb_params&#39;: {&#39;boosting_type&#39;: &#39;gbdt&#39;,
  &#39;objective&#39;: &#39;regression&#39;,
  &#39;metric&#39;: None,
  &#39;subsample&#39;: 0.5,
  &#39;subsample_freq&#39;: 1,
  &#39;learning_rate&#39;: 0.03,
  &#39;num_leaves&#39;: 255,
  &#39;min_data_in_leaf&#39;: 255,
  &#39;feature_fraction&#39;: 0.8,
  &#39;n_estimators&#39;: 5000,
  &#39;early_stopping_rounds&#39;: 50,
  &#39;device_type&#39;: &#39;cpu&#39;,
  &#39;seed&#39;: 42,
  &#39;verbose&#39;: -1},
 &#39;target&#39;: &#39;sales&#39;,
 &#39;p_horizon&#39;: 28,
 &#39;num_series&#39;: 30490,
 &#39;features_json&#39;: &#39;final_features.json&#39;,
 &#39;path_data_raw&#39;: &#39;../../../data/raw&#39;,
 &#39;path_features&#39;: &#39;../../../data/features&#39;,
 &#39;path_models&#39;: &#39;../../../data/models&#39;,
 &#39;use_neptune&#39;: 0,
 &#39;neptune_project&#39;: None,
 &#39;neptune_api_token&#39;: None}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">FINAL_CFG</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;start_test&#39;: 1942,
 &#39;start_train&#39;: 140,
 &#39;days_to_predict&#39;: &#39;all&#39;,
 &#39;fobj&#39;: &#39;mse&#39;,
 &#39;fobj_weight_col&#39;: &#39;total_scaled_weight&#39;,
 &#39;weight_hess&#39;: 1,
 &#39;feval&#39;: &#39;mse&#39;,
 &#39;feval_weight_col&#39;: &#39;scale&#39;,
 &#39;weight_col&#39;: None,
 &#39;lgb_params&#39;: {&#39;boosting_type&#39;: &#39;gbdt&#39;,
  &#39;objective&#39;: None,
  &#39;metric&#39;: None,
  &#39;subsample&#39;: 0.5,
  &#39;subsample_freq&#39;: 1,
  &#39;learning_rate&#39;: 0.03,
  &#39;num_leaves&#39;: 255,
  &#39;min_data_in_leaf&#39;: 255,
  &#39;feature_fraction&#39;: 0.8,
  &#39;n_estimators&#39;: 1,
  &#39;early_stopping_rounds&#39;: 50,
  &#39;device_type&#39;: &#39;cpu&#39;,
  &#39;seed&#39;: 42,
  &#39;verbose&#39;: -1},
 &#39;target&#39;: &#39;sales&#39;,
 &#39;p_horizon&#39;: 28,
 &#39;num_series&#39;: 30490,
 &#39;features_json&#39;: &#39;pkl_final_features.json&#39;,
 &#39;path_data_raw&#39;: &#39;data/raw&#39;,
 &#39;path_features&#39;: &#39;data/features&#39;,
 &#39;path_models&#39;: &#39;data/models&#39;,
 &#39;use_neptune&#39;: 0,
 &#39;neptune_project&#39;: 0,
 &#39;neptune_api_token&#39;: None}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">DICT_FEATURES</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;fe_base.csv&#39;: [&#39;dept_id&#39;, &#39;store_id&#39;],
 &#39;fe_cal.csv&#39;: [&#39;event_name_1&#39;, &#39;tm_d&#39;, &#39;tm_w&#39;, &#39;tm_m&#39;, &#39;tm_dw&#39;, &#39;tm_w_end&#39;],
 &#39;fe_price.csv&#39;: [&#39;sell_price&#39;,
  &#39;price_min&#39;,
  &#39;price_max&#39;,
  &#39;price_median&#39;,
  &#39;price_mode&#39;,
  &#39;price_mean&#39;,
  &#39;price_std&#39;,
  &#39;price_norm_max&#39;,
  &#39;price_norm_mode&#39;,
  &#39;price_norm_mean&#39;,
  &#39;price_momentum&#39;,
  &#39;price_roll_momentum_4&#39;,
  &#39;price_roll_momentum_24&#39;,
  &#39;price_end_digits&#39;],
 &#39;fe_snap_event.csv&#39;: [&#39;snap_transform_1&#39;,
  &#39;snap_transform_2&#39;,
  &#39;next_event_type_1&#39;,
  &#39;last_event_type_1&#39;,
  &#39;days_since_event&#39;,
  &#39;days_until_event&#39;],
 &#39;shift_fe_dow_means_and_days_since_sale.csv&#39;: [&#39;mean_4_dow_0&#39;,
  &#39;mean_4_dow_1&#39;,
  &#39;mean_4_dow_2&#39;,
  &#39;mean_4_dow_3&#39;,
  &#39;mean_4_dow_4&#39;,
  &#39;mean_4_dow_5&#39;,
  &#39;mean_4_dow_6&#39;,
  &#39;mean_20_dow_0&#39;,
  &#39;mean_20_dow_1&#39;,
  &#39;mean_20_dow_2&#39;,
  &#39;mean_20_dow_3&#39;,
  &#39;mean_20_dow_4&#39;,
  &#39;mean_20_dow_5&#39;,
  &#39;mean_20_dow_6&#39;,
  &#39;days_since_sale&#39;],
 &#39;shift_fe_ipca_15_84.csv&#39;: [&#39;index&#39;,
  &#39;ipca_15_84_comp_1&#39;,
  &#39;ipca_15_84_comp_2&#39;,
  &#39;ipca_15_84_comp_3&#39;,
  &#39;ipca_15_84_comp_4&#39;,
  &#39;ipca_15_84_comp_5&#39;,
  &#39;ipca_15_84_comp_6&#39;,
  &#39;ipca_15_84_comp_7&#39;,
  &#39;ipca_15_84_comp_8&#39;,
  &#39;ipca_15_84_comp_9&#39;,
  &#39;ipca_15_84_comp_10&#39;,
  &#39;ipca_15_84_comp_11&#39;,
  &#39;ipca_15_84_comp_12&#39;,
  &#39;ipca_15_84_comp_13&#39;,
  &#39;ipca_15_84_comp_14&#39;],
 &#39;shift_fe_lags_1_14.csv&#39;: [&#39;lag_1&#39;,
  &#39;lag_2&#39;,
  &#39;lag_3&#39;,
  &#39;lag_4&#39;,
  &#39;lag_5&#39;,
  &#39;lag_6&#39;,
  &#39;lag_7&#39;,
  &#39;lag_8&#39;,
  &#39;lag_9&#39;,
  &#39;lag_10&#39;,
  &#39;lag_11&#39;,
  &#39;lag_12&#39;,
  &#39;lag_13&#39;,
  &#39;lag_14&#39;],
 &#39;shift_fe_rw_1.csv&#39;: [&#39;shift_1_rolling_nanmean_3&#39;,
  &#39;shift_1_rolling_mean_decay_3&#39;,
  &#39;shift_1_rolling_nanmean_7&#39;,
  &#39;shift_1_rolling_mean_decay_7&#39;,
  &#39;shift_1_rolling_nanstd_7&#39;],
 &#39;shift_fe_rw_2.csv&#39;: [&#39;shift_1_rolling_nanmean_14&#39;,
  &#39;shift_1_rolling_mean_decay_14&#39;,
  &#39;shift_1_rolling_diff_nanmean_14&#39;,
  &#39;shift_1_rolling_nanstd_14&#39;,
  &#39;shift_1_rolling_nanmean_30&#39;,
  &#39;shift_1_rolling_mean_decay_30&#39;],
 &#39;shift_fe_rw_3.csv&#39;: [&#39;shift_1_rolling_nanmean_60&#39;,
  &#39;shift_1_rolling_nanmedian_60&#39;,
  &#39;shift_1_rolling_mean_decay_60&#39;,
  &#39;shift_1_rolling_nanstd_60&#39;,
  &#39;shift_1_rolling_nanmean_140&#39;,
  &#39;shift_1_rolling_mean_decay_140&#39;,
  &#39;shift_1_rolling_nanstd_140&#39;],
 &#39;shift_fe_shifts_mom_1.csv&#39;: [&#39;shift_8_rolling_nanmean_7&#39;,
  &#39;momentum_7_rolling_nanmean_7&#39;,
  &#39;shift_8_rolling_mean_decay_7&#39;,
  &#39;momentum_7_rolling_mean_decay_7&#39;,
  &#39;momentum_7_rolling_diff_nanmean_7&#39;,
  &#39;shift_29_rolling_nanmean_7&#39;,
  &#39;momentum_28_rolling_nanmean_7&#39;,
  &#39;shift_29_rolling_mean_decay_7&#39;,
  &#39;momentum_28_rolling_mean_decay_7&#39;,
  &#39;shift_29_rolling_diff_nanmean_7&#39;,
  &#39;momentum_28_rolling_diff_nanmean_7&#39;],
 &#39;shift_fe_shifts_mom_2.csv&#39;: [&#39;shift_8_rolling_nanmean_30&#39;,
  &#39;momentum_7_rolling_nanmean_30&#39;,
  &#39;shift_8_rolling_mean_decay_30&#39;,
  &#39;shift_29_rolling_nanmean_30&#39;,
  &#39;momentum_28_rolling_nanmean_30&#39;,
  &#39;shift_29_rolling_mean_decay_30&#39;],
 &#39;shift_fe_shifts_mom_3.csv&#39;: [&#39;shift_29_rolling_nanmean_60&#39;,
  &#39;shift_91_rolling_nanmean_60&#39;,
  &#39;shift_91_rolling_mean_decay_60&#39;]}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="prep_data" class="doc_header"><code>prep_data</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/m5/daily_models.py#L211" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>prep_data</code>(<strong><code>cfg</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="neptune" class="doc_header"><code>neptune</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/m5/daily_models.py#L232" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>neptune</code>(<strong><code>cfg</code></strong>)</p>
</blockquote>
<p>Not implemented</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">neptune</span><span class="p">(</span><span class="n">cfg</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lgb_daily" class="doc_header"><code>lgb_daily</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/m5/daily_models.py#L238" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lgb_daily</code>(<strong><code>path_cfg</code></strong>:<code>str</code>=<em><code>'cfg.json'</code></em>)</p>
</blockquote>
<p>Train 1 model for each day of prediction accoring to <code>path_cfg</code>.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="cli_lgb_daily" class="doc_header"><code>cli_lgb_daily</code><a href="https://github.com/chrisrichardmiles/chrisrichardmiles/tree/master/chrisrichardmiles/m5/daily_models.py#L349" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>cli_lgb_daily</code>(<strong><code>path_cfg</code></strong>:"path to the configuration json"=<em><code>'cfg.json'</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Neptune-code">Neptune code<a class="anchor-link" href="#Neptune-code"> </a></h3>
</div>
</div>
</div>
</div>
 

